<div bind:this={self} id="panel-left" class:indicator-on="{focused}" class:gone="{hidden}" class:auto-hide="{autoHide}">
    <TabBar bind:this={tabBar} id="tab-bar"></TabBar>
    <FileTree bind:this={children.FileTree} on:active={onTabChange}></FileTree>
    <Outline bind:this={children.Outline} on:active={onTabChange}></Outline>
</div>


<style>
    #panel-left {
        position: fixed;
        top: var(--toolbar-height);
        left: 0;
        height: calc(100% - var(--toolbar-height));
        width: var(--panel-left-width);
        background: var(--panel-color);
        border-right: var(--panel-border);
        box-sizing: border-box;
    }

</style>

<script>
    import { beforeUpdate, onMount } from 'svelte';

    export let self
    export let children = {}
    export let tabBar

    import g from './lib/Globals'
    import { setAttributeForMultipleComponent, schedule } from './lib/Utils'
    import { initializeTabView } from './lib/Utils'

    export let focused = false;
    export let hidden = false;
    export let autoHide = false;

    import TabBar from './bars/TabBar.html';
    import FileTree from './panels/FileTree.html';
    import Outline from './panels/Outline.html';

    function onTabChange({ detail }) {
        if (detail.active === true) {
            for (const [name, view] of Object.entries(children)) {
                if (name !== detail.name && view) {
                    view.active = false
                }
            }
        }
        tabBar.updateTabIndicator(detail)
    }
    
    onMount(() => {
        // TODO: refactor, remove tabBar
        initializeTabView(children.FileTree, tabBar, 'FileTree', 'fas fa-tree l-green')
        initializeTabView(children.Outline, tabBar, 'Outline', 'fas fa-align-left l-blue')
        
        
//        g.panelLeft = this
//        __this.tabBar = tabBar
//        setAttributeForMultipleComponent({
//            parent: this
//        }, tabBar, fileTree, outline)
        schedule(() => {            
        children[g.projectState.activePanels.left].active = true
        })
    });

    // [svelte-upgrade warning]
    // beforeUpdate and afterUpdate handlers behave
    // differently to their v2 counterparts
//    beforeUpdate(() => {
//        if (changed.hidden) {
//            if (current.hidden) {
//                __this.originalWidth = panelLeft.getBoundingClientRect().width
//                document.documentElement.style.setProperty('--panel-left-width', '0px')
//            } else if (__this.originalWidth)
//                document.documentElement.style.setProperty('--panel-left-width', __this.originalWidth + 'px')
//        }
//    });

    // [svelte-upgrade suggestion]
    // review these functions and remove unnecessary 'export' keywords
    export function closeView() {
        // not allowed to close view for now
    }
</script>


