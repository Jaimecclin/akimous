{#if open}
<div ref:keymapSettings id="keymap-settings" class="popup from-top" style="left: calc({left}px - 12.5rem);">
    <div class="container">
        <div class="title">Keymap Settings</div>
        <div class="option" class:checked="layeredKeyboardControl" on:click="toggle('layeredKeyboardControl')">
            <i class="checkbox fas"/>
            <span class="description">Enable layered keyboard control</span>
        </div>
        {#if layeredKeyboardControl}
        <div class="option" class:checked="keymapHint" on:click="toggle('keymapHint')">
            <i class="checkbox fas"/>
            <span class="description">Show keymap hint</span>
        </div>
        {/if}
    </div>
</div>
{/if}


<script>
    import g from '../lib/Globals'
    import { config, setConfig } from '../lib/ConfigManager'

    export default {
        components: {},
        oncreate() {
            g.keymapSettings = this
        },
        onstate({ changed, current }) {
            if (!g.toolbar) return
            if (changed.open) {
                g.app.set({
                    popup: current.open ? this : null
                })
            }
            if (changed.layeredKeyboardControl && !current.layeredKeyboardControl && current.keymapHint) {
                requestAnimationFrame(() => this.set({
                    keymapHint: false
                }))
            }
            if (changed.layeredKeyboardControl) {
                g.layeredKeyboardControl.enabled = current.layeredKeyboardControl
            }
            if (changed.keymapHint) {
                g.keyboardControlHint.set({ open: current.keymapHint })
            }
        },
        data() {
            return {
                open: false,
                left: 0,
                layeredKeyboardControl: config.keymap.layeredKeyboardControl,
                keymapHint: config.keymap.keymapHint,
            }
        },
        methods: {
            toggle(name) {
                const value = this.get()[name]
                const updated = { [name]: !value }
                this.set(updated)
                setConfig('keymap', updated)
            }
        }
    }

</script>
