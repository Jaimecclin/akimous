<div id="open-folder" class="popup">
    <div class="title">Open Folder</div>
    <div class="path-bar">
        <div class="button" on:click="home()"><i class="fas fa-home"></i></div>
        <div class="button" on:click="up()"><i class="fas fa-arrow-up"></i></div>
        <div class="path">
            <TextInput theme="bright" bind:value="currentPath" on:click="focusPathInput()" on:keydown|capture="pathKeyDown()"></TextInput>
        </div>
    </div>
    <div class="list">
        {#each list as item}
        <div class="item non-selectable" on:click="folderClicked(item)">
            <i class="fas fa-folder"></i> {item}
        </div>
        {/each}
    </div>
</div>


<style>
    #open-folder {
        position: fixed;
        width: 80vw;
        height: 80vh;
        left: 10vw;
        top: 10vh;
        padding: 1.5rem;
    }

    .title {
        color: var(--primary5);
        font-weight: 400;
    }

    .path-bar {
        margin: .5rem;
    }

    .button {
        display: inline-block;
        width: 2rem;
        height: 2rem;
        line-height: 2rem;
        font-size: 1rem;
        text-align: center;
        vertical-align: top;
    }

    .path {
        display: inline-block;
        width: calc(100% - 6rem);
    }

    .list {
        margin: 1rem;
        color: var(--gray3);
        font-size: 1.4rem;
        height: calc(80vh - 12rem);
        overflow: scroll;
    }

    .item {
        padding-bottom: .3rem;
    }

    .fa-folder {
        color: var(--gray5);
        padding-right: .5rem;
    }

</style>


<script>
    // import g from './lib/Globals'

    export default {
        components: {
            TextInput: '../lib/TextInput.html'
        },
        oncreate() {
            this.session = g.socket.createSession('openFolder')
            this.session.handlers['Listed'] = data => {
                this.set(data)
            }
            this.home()
        },
        data() {
            return {
                currentPath: '',
                list: []
            }
        },
        methods: {
            folderClicked(folder) {
                this.session.send('Ls', [this.get().currentPath, folder])
            },
            pathKeyDown() {
                if (event.key !== 'Enter') return
                this.session.send('Ls', [this.get().currentPath])
            },
            focusPathInput() {
                g.setFocus([this])
            },
            home() {
                this.session.send('Home')
            },
            up() {
                this.session.send('Ls', [this.get().currentPath, '..'])
            }
        }
    }

</script>
