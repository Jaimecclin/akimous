<div bind:this={row} class="context-menu-row non-selectable" class:selected on:mouseover="{mouseover}" on:click="{click}">
    <span class="icon">
        <i class="{icon}" aria-hidden="true"></i>
    </span>
    <span class="text">{@html text}</span>
    <span class="hotkey">{@html hotkey}</span>
</div>


<style>
    .context-menu-row {
        height: var(--ui-line-height-large);
        line-height: var(--ui-line-height-large);
        padding: 0 4rem 0 1rem;
        font-weight: 400;
        white-space: nowrap;
    }

    .selected {
        color: var(--brighter-ui-font-color);
        background: var(--primary5);
    }

    .icon {
        width: 1rem;
        display: inline-block;
        margin-right: 0.5rem;
        color: var(--gray5);
        text-align: center;
    }

    .text {
        display: inline-block;
        min-width: 10em;
    }

    .selected .icon {
        color: var(--gray9);
    }

    .hotkey {
        color: var(--gray6);
        position: absolute;
        right: 0.5rem;
    }

    .selected .hotkey {
        color: var(--gray9);
    }

</style>
   
<script>
    import { afterUpdate } from 'svelte'

    // [svelte-upgrade suggestion]
    // manually refactor all references to __this
    const __this = {}

    export let row

    import ClipboardJS from 'clipboard'

    export let icon = ''
    export let text = ''
    export let hotkey = ''
    export let selected = false
    export let callback = null
    export let clipboardText = null


    // [svelte-upgrade warning]
    // beforeUpdate and afterUpdate handlers behave
    // differently to their v2 counterparts
    afterUpdate(() => {
//        if (changed.clipboardText) {
//            if (current.clipboardText) {
//                // dirty hack to make copying text work, as browsers do not allow in allow async API on localhost
//                __this.clipboardHandler = new ClipboardJS(row, {
//                    text: () => {
//                        return current.clipboardText
//                    }
//                })
//            } else {
//                if (__this.clipboardHandler) {
//                    __this.clipboardHandler.destroy()
//                    __this.clipboardHandler = null
//                }
//            }
//        }
    })

    // [svelte-upgrade suggestion]
    // review these functions and remove unnecessary 'export' keywords
    export function mouseover() {
        __this.parent.set({
            selectedRow: this
        })
    }

    export function click() {
        callback && callback(__this.parent.get().caller)
        __this.parent.set({
            open: false
        })
    }
</script>
