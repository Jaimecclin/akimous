<div class="text-input" class:editing>
    {#if editing}
    <input bind:this={input} type="text" spellcheck="false" bind:value on:change on:keydown on:blur="{commitChange}">
    {:else}
    <span>{value}</span>
    {/if}
</div>


<style>
    .text-input {
        display: inline-block;
        padding-left: .4rem;
        vertical-align: middle;
    }

    .text-input.editing {
        margin: -.37rem -1rem -.37rem -.07rem;
    }

    input {
        border: .07rem solid var(--gray7);
        border-radius: var(--small-radius);
        padding: .3rem;
        font-weight: 300;
        width: 18rem;
    }

    input:hover {
        filter: brightness(1.2);
    }

    input:active,
    input:focus {
        border: .07rem solid var(--ui-highlight-color);
        outline: none;
    }

</style>


<script>
    import { beforeUpdate } from 'svelte'

    import g from '../lib/Globals'
    
    export let input = '',
        editing = false,
        value = '',
        placeholder = '',
        allowWhiteSpace = true,
        index = 0,
        shellCommands = []
    

    // [svelte-upgrade warning]
    // beforeUpdate and afterUpdate handlers behave
    // differently to their v2 counterparts
    beforeUpdate(() => {
//        if (changed.value) {
//            const { shellCommands } = current
//            shellCommands[current.index] = current.value
//
//            if (current.index === shellCommands.length - 1) {
//                if (current.value.length) {
//                    shellCommands.push('')
//                    g.runConfiguration.set({
//                        shellCommands
//                    })
//                }
//            }
//        }
    })

    // [svelte-upgrade suggestion]
    // review these functions and remove unnecessary 'export' keywords
    export function commitChange() {
        if (!value.length) {
            shellCommands.splice(index, 1)
            g.runConfiguration.set({ shellCommands })
        }
        g.runConfiguration.saveChanges()
    }
</script>
