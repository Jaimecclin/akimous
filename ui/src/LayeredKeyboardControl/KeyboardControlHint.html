{#if open}
<div ref:self id="keyboard-control-hint">
    <div id="hint-description">{@html description}</div>
    <ul class="row">
        <li class="key fn" id="key-Escape" on:mouseover="showDescription('Escape')">esc</li>
        <li class="key fn" id="key-F1" on:mouseover="showDescription('F1')">F1</li>
        <li class="key fn" id="key-F2" on:mouseover="showDescription('F2')">F2</li>
        <li class="key fn" id="key-F3" on:mouseover="showDescription('F3')">F3</li>
        <li class="key fn" id="key-F4" on:mouseover="showDescription('F4')">F4</li>
        <li class="key fn" id="key-F5" on:mouseover="showDescription('F5')">F5</li>
        <li class="key fn" id="key-F6" on:mouseover="showDescription('F6')">F6</li>
        <li class="key fn" id="key-F7" on:mouseover="showDescription('F7')">F7</li>
        <li class="key fn" id="key-F8" on:mouseover="showDescription('F8')">F8</li>
        <li class="key fn" id="key-F9" on:mouseover="showDescription('F9')">F9</li>
        <li class="key fn" id="key-F10" on:mouseover="showDescription('F10')">F10</li>
        <li class="key fn" id="key-F11" on:mouseover="showDescription('F11')">F11</li>
        <li class="key fn" id="key-F12" on:mouseover="showDescription('F12')">F12</li>
        <li class="key fn" id="key-Delete" on:mouseover="showDescription('Delete')">{@html keys[mode].Delete}</li>
    </ul>
    <ul class="row">
        <li class="key" id="key-Backquote" on:mouseover="showDescription('Backquote')">`</li>
        <li class="key" id="key-Digit1" on:mouseover="showDescription('Digit1')">{@html keys[mode].Digit1}</li>
        <li class="key" id="key-Digit2" on:mouseover="showDescription('Digit2')">{@html keys[mode].Digit2}</li>
        <li class="key" id="key-Digit3" on:mouseover="showDescription('Digit3')">{@html keys[mode].Digit3}</li>
        <li class="key" id="key-Digit4" on:mouseover="showDescription('Digit4')">{@html keys[mode].Digit4}</li>
        <li class="key" id="key-Digit5" on:mouseover="showDescription('Digit5')">{@html keys[mode].Digit5}</li>
        <li class="key" id="key-Digit6" on:mouseover="showDescription('Digit6')">{@html keys[mode].Digit6}</li>
        <li class="key" id="key-Digit7" on:mouseover="showDescription('Digit7')">{@html keys[mode].Digit7}</li>
        <li class="key" id="key-Digit8" on:mouseover="showDescription('Digit8')">8</li>
        <li class="key" id="key-Digit9" on:mouseover="showDescription('Digit9')">9</li>
        <li class="key" id="key-Digit0" on:mouseover="showDescription('Digit0')">0</li>
        <li class="key" id="key-Minus" on:mouseover="showDescription('Minus')">{@html keys[mode].Minus}</li>
        <li class="key" id="key-Equal" on:mouseover="showDescription('Equal')">=</li>
        <li class="key" id="key-Backspace" on:mouseover="showDescription('Backspace')">{@html keys[mode].Backspace}</li>
    </ul>
    <ul class="row">
        <li class="key" id="key-Tab" on:mouseover="showDescription('Tab')">⇥</li>
        <li class="key" id="key-Q" on:mouseover="showDescription('Q')"></li>
        <li class="key" id="key-W" on:mouseover="showDescription('W')">{@html keys[mode].W}</li>
        <li class="key" id="key-E" on:mouseover="showDescription('E')">{@html keys[mode].E}</li>
        <li class="key" id="key-R" on:mouseover="showDescription('R')">{@html keys[mode].R}</li>
        <li class="key" id="key-T" on:mouseover="showDescription('T')">{@html keys[mode].T}</li>
        <li class="key" id="key-Y" on:mouseover="showDescription('Y')">{@html keys[mode].Y}</li>
        <li class="key" id="key-U" on:mouseover="showDescription('U')">{@html keys[mode].U}</li>
        <li class="key" id="key-I" on:mouseover="showDescription('I')">{@html keys[mode].I}</li>
        <li class="key" id="key-O" on:mouseover="showDescription('O')">{@html keys[mode].O}</li>
        <li class="key" id="key-P" on:mouseover="showDescription('P')">{@html keys[mode].P}</li>
        <li class="key" id="key-BracketLeft" on:mouseover="showDescription('BracketLeft')">{@html keys[mode].BracketLeft}</li>
        <li class="key" id="key-BracketRight" on:mouseover="showDescription('BracketRight')">{@html keys[mode].BracketRight}</li>
        <li class="key" id="key-Backslash" on:mouseover="showDescription('Backslash')"></li>
    </ul>
    <ul class="row">
        <li class="key" id="caps">⇪</li>
        <li class="key" id="key-A" on:mouseover="showDescription('A')"></li>
        <li class="key" id="key-S" on:mouseover="showDescription('S')">{@html keys[mode].S}</li>
        <li class="key" id="key-D" on:mouseover="showDescription('D')">{@html keys[mode].D}</li>
        <li class="key" id="key-F" on:mouseover="showDescription('F')">{@html keys[mode].F}</li>
        <li class="key" id="key-G" on:mouseover="showDescription('G')">{@html keys[mode].G}</li>
        <li class="key" id="key-H" on:mouseover="showDescription('H')">{@html keys[mode].H}</li>
        <li class="key" id="key-J" on:mouseover="showDescription('J')">{@html keys[mode].J}</li>
        <li class="key" id="key-K" on:mouseover="showDescription('K')">{@html keys[mode].K}</li>
        <li class="key" id="key-L" on:mouseover="showDescription('L')">{@html keys[mode].L}</li>
        <li class="key" id="key-Semicolon" on:mouseover="showDescription('Semicolon')">{@html keys[mode].Semicolon}</li>
        <li class="key" id="key-Quote" on:mouseover="showDescription('Quote')"></li>
        <li class="key" id="key-Enter" on:mouseover="showDescription('Enter')">⏎</li>
    </ul>
    <ul class="row">
        <li class="key" id="key-ShiftLeft" on:mouseover="showDescription('ShiftLeft')">⇧</li>
        <li class="key" id="key-Z" on:mouseover="showDescription('Z')"></li>
        <li class="key" id="key-X" on:mouseover="showDescription('X')"></li>
        <li class="key" id="key-C" on:mouseover="showDescription('C')">{@html keys[mode].C}</li>
        <li class="key" id="key-V" on:mouseover="showDescription('V')"></li>
        <li class="key" id="key-B" on:mouseover="showDescription('B')"></li>
        <li class="key" id="key-N" on:mouseover="showDescription('N')">{@html keys[mode].N}</li>
        <li class="key" id="key-M" on:mouseover="showDescription('M')">{@html keys[mode].M}</li>
        <li class="key" id="key-Comma" on:mouseover="showDescription('Comma')">{@html keys[mode].Comma}</li>
        <li class="key" id="key-Period" on:mouseover="showDescription('Period')">{@html keys[mode].Period}</li>
        <li class="key" id="key-Slash" on:mouseover="showDescription('Slash')">{@html keys[mode].Slash}</li>
        <li class="key" id="key-ShiftRight" on:mouseover="showDescription('ShiftRight')">⇧</li>
    </ul>
    <ul class="row" id="bottomrow">
        <li class="key">fn</li>
        <li class="key" id="key-ControlLeft" on:mouseover="showDescription('ControlLeft')">⌃</li>
        <li class="key" id="key-AltLeft" on:mouseover="showDescription('AltLeft')">⌥</li>
        <li class="key" id="key-MetaLeft" on:mouseover="showDescription('MetaLeft')">⌘</li>
        <li class="key" id="key-Space" on:mouseover="showDescription('Space')"></li>
        <li class="key" id="key-MetaRight" on:mouseover="showDescription('MetaRight')">⌘</li>
        <li class="key" id="key-AltRight" on:mouseover="showDescription('AltRight')">⌥</li>
        <ol class="cf">
            <li class="key" id="key-ArrowLeft" on:mouseover="showDescription('ArrowLeft')">◀</li>
            <li>
                <i class="key" id="key-ArrowUp" on:mouseover="showDescription('ArrowUp')">▲</i>
                <i class="key" id="key-ArrowDown" on:mouseover="showDescription('ArrowDown')">▼</i>
            </li>
            <li class="key" id="key-ArrowRight" on:mouseover="showDescription('ArrowRight')">▶</li>
        </ol>
    </ul>
</div>
{/if}

<style>
    #keyboard-control-hint {
        position: absolute;
        background: var(--dark-color);
        bottom: 2rem;
        right: 2rem;
        height: 14.4rem;
        width: 33rem;
        z-index: 160;
        border-radius: var(--default-radius);
        box-shadow: var(--default-shadow);
        user-select: none;
        cursor: default;
    }

    #hint-description {
        height: 2rem;
        line-height: 2rem;
        text-align: center;
    }

    .row {
        padding-left: .3rem;
    }

    ul {
        list-style-type: none;
        width: 100%;
        margin: 0 auto;
        padding-left: .2rem;
    }

    li {
        float: left;
    }

    i {
        font-style: normal;
    }

    .key {
        display: block;
        color: var(--darker-ui-font-color);
        font-size: 1rem;
        text-align: center;
        text-decoration: none;
        width: 2rem;
        height: 2rem;
        line-height: 2rem;
        margin: .1rem .12rem;
        background: var(--darker-color);
        border-radius: .1rem;
        border-top: .05rem solid #444;
        border-bottom: .05rem solid black;
        box-sizing: border-box;
    }

    .fn {
        height: 1rem;
        line-height: 1rem;
        font-size: .5rem;
        margin: 0 .16rem .1rem .16rem;
        padding-top: 0;
    }

    #key-Escape {
        font-size: 0.3rem;
    }

    #key-Backspace {
        width: 3.2em;
    }

    #key-Tab {
        width: 3.2em;
    }

    #caps {
        width: 3.7rem;
    }

    #key-Enter {
        width: 3.7rem;
    }

    #key-ShiftLeft,
    #key-ShiftRight {
        width: 4.8rem;
    }

    #key-Space {
        width: 12rem;
    }

    ul ol {
        list-style-type: none;
    }

    #key-ArrowUp,
    #key-ArrowDown {
        font-size: .5rem;
        line-height: .9rem;
        height: .95rem;
    }

    #key-ArrowLeft,
    #key-ArrowRight {
        font-size: .5rem;
    }

    :global(#keyboard-control-hint div.two-lines) {
        line-height: .8rem;
        font-size: .8rem;
        padding-top: .3rem;
    }

    :global(#keyboard-control-hint .bigger) {
        line-height: 1.8rem;
        font-size: 1.5rem;
    }

    :global(#keyboard-control-hint .lower) {
        padding-top: .2rem;
    }

    :global(#keyboard-control-hint .small) {
        font-size: .75rem;
    }

    :global(#keyboard-control-hint .active) {
        box-shadow: var(--blue) 0 0 0 .2rem;
    }
    
    :global(#keyboard-control-hint .highlight) {
        animation-name: highlight-animation;
        animation-duration: 1s;
    }
    
    @keyframes highlight-animation {
        0% {
            background: var(--blue);
            border-top: .05rem solid var(--blue);
            border-bottom: .05rem solid var(--blue);
        }
        100% {
            background: var(--darker-color);
        }
    }
    
    :global(#keyboard-control-hint .persistent-highlight) {
        background: var(--blue);
    }

</style>


<script>
    import g from '../lib/Globals'
    import { dragElement } from '../lib/UIUtils'

    export default {
        components: {},
        oncreate() {
            g.keyboardControlHint = this
        },
        onstate({ changed, current }) {
            if (changed.open && g.toolbar) {
                g.toolbar.refs.keyboardControlHint.set({
                    on: current.open
                })
            }
        },
        onupdate({ changed, current }) {
            if (changed.open && g.toolbar) {
                if (current.open) {
                    dragElement(this.refs.self)
                } 
            }
        },
        data() {
            return {
                open: false,
                mode: 'normal',
                description: '',
                keys: {
                    normal: {
                        Delete: '<div class="l-red">⌦</div>',
                        Backspace: '<div class="l-red">⌫</div>',

                        Digit1: '<div class="l-sandybrown">1</div>',
                        Digit2: '<div class="l-sandybrown">2</div>',
                        Digit3: '<div class="l-sandybrown">3</div>',
                        Digit4: '<div class="l-sandybrown">4</div>',
                        Digit5: '<div class="l-sandybrown">5</div>',
                        Digit6: '<div class="l-sandybrown">6</div>',
                        Digit7: '<div class="l-sandybrown">7</div>',
                        Minus: '<div class="l-brighter-red">-</div>',

                        W: '<div class="bigger l-yellow">⤉</div>',
                        E: '<div class="bigger lower l-ao">⇞</div>',
                        R: '<div class="bigger l-purple">—</div>',
                        T: '<i class="fas fa-square l-purple"></i>',
                        Y: '<div class="bigger l-green">⇱</div>',
                        U: '<div class="two-lines l-green">▲<br>x5</div>',
                        I: '<div class="l-blue">▲</div>',
                        O: '<div class="two-lines l-green">▼<br>x5</div>',
                        P: '<div class="bigger l-green">⇲</div>',
                        BracketLeft: '<div class="l-olive"><b>[</b></div>',
                        BracketRight: '<div class="l-olive"><b>]</b></div>',

                        S: '<div class="bigger l-yellow">⤈</div>',
                        D: '<div class="bigger lower l-ao">⇟</div>',
                        F: '<i class="fas fa-mouse-pointer l-purple"></i>',
                        G: '<b><div class="l-purple">{ }</div></b>',
                        H: '<i class="fas fa-fast-backward l-green"></i>',
                        J: '<div class="l-blue">◀</div>',
                        K: '<div class="l-blue">▼</div>',
                        L: '<div class="l-blue">▶</div>',
                        Semicolon: '<i class="fas fa-fast-forward l-green"></i>',

                        C: '<div class="l-orange">℄</div>',
                        N: '<b><span class="l-purple">|</span> ||</b>',
                        M: '<b><span class="l-blue">|</span> ||</b>',
                        Comma: '<b>| <span class="l-blue">|</span> |</b>',
                        Period: '<b>|| <span class="l-blue">|</span></b>',
                        Slash: '<b>|| <span class="l-purple">|</span></b>',
                    }
                },
                descriptions: {
                    normal: {
                        Delete: 'Delete word after cursor',
                        Backspace: 'Delete word before cursor',

                        Digit1: 'Select the 1st item in auto-completion',
                        Digit2: 'Select the 2nd item in auto-completion',
                        Digit3: 'Select the 3rd item in auto-completion',
                        Digit4: 'Select the 4th item in auto-completion',
                        Digit5: 'Select the 5th item in auto-completion',
                        Digit6: 'Select the 6th item in auto-completion',
                        Digit7: 'Select the 7th item in auto-completion',
                        Minus: 'Fold/unfold the code block',

                        W: 'Move Line Up',
                        E: 'Scroll Up',
                        R: 'Select Line',
                        T: 'Select Block',
                        Y: 'Move the cursor to the start of the document',
                        U: 'Move the cursor up by 5 lines',
                        I: 'Move the cursor up by a line',
                        O: 'Move the cursor down by 5 lines',
                        P: 'Move the cursor to the end of the document',
                        BracketLeft: 'Move the cursor to the opening braces/brackets/curly braces',
                        BracketRight: 'Move the cursor to the closing braces/brackets/curly braces',

                        S: 'Move line down',
                        D: 'Scroll down',
                        F: 'Select word (incremental selection)',
                        G: 'Select between braces/brackets/curly braces',
                        H: 'Move the cursor to the start of the line',
                        J: 'Move the cursor left by a word',
                        K: 'Move the cursor down by a line',
                        L: 'Move the cursor right by a word',
                        Semicolon: 'Move the cursor to the end of the line',

                        C: 'Move the cursor to the center line in the viewport',
                        N: 'Toggle auto-hide of the left panel',
                        M: 'Focus on the left panel',
                        Comma: 'Focus on the editor',
                        Period: 'Focus on the right panel',
                        Slash: 'Toggle auto-hide of the right panel',

                        Space: '<div class="small">Hold down the space bar and tap on one of the keys with colored icon to execute the command.</div>'
                    }
                }
            }
        },
        methods: {
            showDescription(key) {
                const { open, mode, descriptions } = this.get()
                if (!open) return 
                const description = descriptions[mode][key]
                this.set({ description: description ? description : '' })
                for (const element of document.querySelectorAll('#keyboard-control-hint .active')) {
                    element.classList.remove('active')
                }
                document.getElementById(`key-${key}`).classList.add('active')
            },
            highlight(key) {
                const { open } = this.get()
                if (!open) return
                const element = document.getElementById(`key-${key}`)
                element.classList.remove('highlight')
                requestAnimationFrame(() => {
                    element.classList.add('highlight')
                })
            },
            highlightModifier(key) {
                const { open } = this.get()
                if (!open) return
                const element = document.getElementById(`key-${key}`)
                if (element.classList.contains('persistent-highlight')) return
                element.classList.add('persistent-highlight')
            },
            dimModifier(key) {
                const { open } = this.get()
                if (!open) return
                const element = document.getElementById(`key-${key}`)
                element.classList.remove('persistent-highlight')
            }
        }
    }

</script>
