<div id="tooltip" class="non-selectable"></div>

<style>
    #tooltip {
        background: rgba(0, 0, 0, .7);
        z-index: 999;
        padding: .2rem .4rem;
        margin-top: .5rem;
        border-radius: var(--small-radius);
        font-size: var(--ui-font-size-small);
    }

</style>

<script>
    import { onMount } from 'svelte'
    import Popper from 'popper.js'
    
    import g from './Globals'

    // [svelte-upgrade suggestion]
    // manually refactor all references to __this
    const __this = {}

    let tooltip

    function mouseEnterListener(event) {
        const { target } = event
        const tooltipElement = document.getElementById('tooltip')
        const label = target.getAttribute('aria-label')
        tooltipElement.textContent = label
        tooltip = new Popper(target, tooltipElement, {
            positionFixed: true,
            eventsEnabled: false,
        })
    }

    function mouseLeaveListener() {
        if (tooltip)
            tooltip.destroy()
    }

    onMount(() => {
        g.Popper = Popper
        __this.mouseEnterListener = mouseEnterListener
        __this.mouseLeaveListener = mouseLeaveListener
    })

    // [svelte-upgrade suggestion]
    // review these functions and remove unnecessary 'export' keywords
    export function register(element) {
        // those listeners should be garbage collected when the element is destroyed
        if (!Array.isArray(element)) {
            element.addEventListener('mouseenter', mouseEnterListener)
            element.addEventListener('mouseleave', mouseLeaveListener)
            return
        }
        for (const i of element) {
            i.addEventListener('mouseenter', mouseEnterListener)
            i.addEventListener('mouseleave', mouseLeaveListener)
        }
    }
</script>
