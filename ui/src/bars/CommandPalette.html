<script>
    import { afterUpdate, onMount } from 'svelte';

    // [svelte-upgrade suggestion]
    // manually refactor all references to __this
    const __this = {
        get: () => ({ active, message, callback })
    };

    export let input;

    import g from '../lib/Globals'

    export let active = false;
    export let message = '';
    export let callback = null;

    onMount(() => {
        g.commandPalette = this
    });

    // [svelte-upgrade warning]
    // beforeUpdate and afterUpdate handlers behave
    // differently to their v2 counterparts
    afterUpdate(() => {
//        if (changed.active && current.active) {
//            g.setFocus([this])
//            input.focus()
//        }
    });

    // [svelte-upgrade suggestion]
    // review these functions and remove unnecessary 'export' keywords
    export function show() {
        active = true, message = 'Command:'
    }

    export function promptForInput(message, callback) {
//        active = true, message = message, callback = callback
    }

    export function onKeyDown() {
        if (event.key === 'Enter') {
            const input = input.value
            __this.get().callback(input)
            active = false
        }
    }
</script>

<div id="command-palette" class="non-selectable" class:gone="{!active}">
    <span class="message">{message}</span>
    <input bind:this={input} type="text" spellcheck="false" on:keydown="{onKeyDown}" />
</div>


<style>
    #command-palette {
        position: absolute;
        top: 0;
        width: 100%;
        height: var(--toolbar-height);
        line-height: var(--toolbar-height);
        z-index: 240;
        color: var(--brighter-ui-font-color);
        text-align: center;
        vertical-align: middle;
        background: var(--blue);
    }

    .message {
        margin-right: .5rem;
    }

    input {
        min-width: 30%;
        background: transparent;
        border: none;
        color: white;
        font-family: var(--ui-font-family);
        font-weight: 300;
    }

    input:focus {
        outline: none;
    }

</style>
