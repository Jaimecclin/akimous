<span bind:this={tab} class="tab non-selectable {active ? 'active' : ''} {clean ? '' : 'dirty'}" style="padding:0 {padding}px" on:click="{activate}" on:dblclick="{close}" on:mouseenter="{mouseEnter}" on:mouseleave="{mouseLeave}" aria-label="{name}">
    <!-- if the two spans sitting on different lines means there is a space in between-->
    <span bind:this={iconSpan} class="icon {icon}" class:icon-height-adjustment="{name}"></span>{#if labeled}<span bind:this={text} class="text">{name}</span>{/if}
</span>


<style>
    .tab {
        border-right: 1px solid var(--panel-delimiter-color);
        height: var(--tab-bar-height);
        display: inline-block;
        overflow-x: visible;
        line-height: var(--tab-bar-height);
        background: var(--panel-color);
    }

    .icon {
        position: relative;
        width: 1rem;
        min-height: 1rem;
        display: inline-block;
        background-size: 100% 100% !important;
    }

    .icon-height-adjustment {
        vertical-align: -5%;
    }
    
    .active {
        background: linear-gradient(to bottom, var(--panel-color) 0%, var(--panel-color) 90%,
            var(--ui-highlight-color) 90%, var(--ui-highlight-color) 100%);
    }

    .text {
        display: inline-block;
        padding-left: .3rem;
    }
    
    .dirty .text {
        color: var(--ui-danger-color) !important;
    }
    
    .active .text {
        color: var(--brighter-ui-font-color);
    }

    .tab:hover .text {
        color: white;
    }

    .active:hover .text {
        color: white;
    }


</style>

   

<script>
    import { beforeUpdate, onDestroy, createEventDispatcher } from 'svelte'

    import g from '../lib/Globals'

    let tab,
        text,
        iconSpan
    
    export let id,
        active = false,
        clean = true,
        padding = 0,
        name = '',
        icon = 'l-python-icon',
        labeled = true,
        parent = null,
        view = null,
        panel = null

    const dispatch = createEventDispatcher()

    onDestroy(() => {
        dispatch('tabDestroyed', { id })
    })

    // [svelte-upgrade warning]
    // beforeUpdate and afterUpdate handlers behave
    // differently to their v2 counterparts
//    beforeUpdate(() => {
//        if (!previous) return
//        if (changed.parent) {
//            previous.parent && previous.parent.tabs.delete(this)
//            current.parent && current.parent.tabs.add(this)
//        }
//    });

    // [svelte-upgrade suggestion]
    // review these functions and remove unnecessary 'export' keywords
    export function activate() {
        view.active = true
    }

    export function close() {
        dispatch('requestTabClose', { view })
    }

    export function mouseEnter() {
        if (padding && labeled)
            return
//        g.tooltip.mouseEnterListener(event)
    }

    export const mouseLeave = () => {
//        g.tooltip.mouseLeaveListener(event)
    }

    export function getIndex() {
        let node = tab
        let index = 0
        while (node) {
            index++
            node = node.previousElementSibling
        }
        return index
    }

    export function getInternalWidth() {
        const textWidth = text ? text.scrollWidth : 0
        return iconSpan.scrollWidth + textWidth
    }

    export function forceSetWidth(x) {
        padding = 0
        tab.style.width = `${x}px`
    }

    export function autoWidth() {
        tab.style.width = ''
    }
</script>

