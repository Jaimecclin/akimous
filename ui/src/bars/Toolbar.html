<div id="toolbar">
    <MenuBar bind:this={children.menuBar} />
<!--    <PathIndicator />-->
    <ToolbarButton on:click="{() => togglePopup('linterOptions')}" iconClass="fas fa-check-circle" title="Beautifier and Linter Options" />
    <ToolbarButton on:click="{() => togglePopup('keymapSettings')}" iconClass="fas fa-fw fa-keyboard" title="Keymap Settings" />
    <ToolbarButton on:click="{() => togglePopup('notificationHistory')}" iconClass="fas fa-fw fa-bell" title="Notification History" />
    <span class="gap">|</span>
    <ToolbarButton on:click="{() => togglePopup('runConfiguration')}" iconClass="fas fa-caret-down" title="Run Configuration">
        <span class="text">{runConfigurationDisplay}</span>
    </ToolbarButton>
    <ToolbarButton on:click="{run}" iconClass="fas fa-play" title="Run" />
    <ToolbarButton on:click="{stop}" iconClass="fas fa-square" title="Stop" />
    <CursorPosition bind:this={cursorPosition} />
</div>
<CommandPalette />
<NotificationBar bind:this={children.notificationBar} />
<TabNumber bind:this={children.tabNumber} />
<NotificationHistory />
<LinterOptions bind:this={linterOptions} />
<RunConfiguration />
<KeymapSettings />

<style>
    #toolbar {
        display: flex;
        height: var(--toolbar-height);
        background: var(--panel-color);
        border-bottom: var(--panel-border);
        box-sizing: border-box;
        z-index: 200;
        user-select: none;
        line-height: var(--toolbar-height);
    }

    .gap {
        color: var(--gray5);
    }

    .text {
        font-size: var(--ui-font-size-small);
        padding: 0 .3rem;
    }

</style>

   

<script>
    import { onMount } from 'svelte'
    
    import g from '../lib/Globals'
    import { schedule } from '../lib/Utils'
    import NotificationBar from './NotificationBar.html'
    import NotificationHistory from '../popups/NotificationHistory.html'
    import LinterOptions from '../popups/LinterOptions.html'
    import RunConfiguration from '../popups/RunConfiguration.html'
    import KeymapSettings from '../popups/KeymapSettings.html'
    import TabNumber from './TabNumber.html'
    import ToolbarButton from './ToolbarButton.html'
    import MenuBar from './MenuBar.html'
    import CursorPosition from './CursorPosition.html'
    import CommandPalette from './CommandPalette.html'
//    import PathIndicator from './PathIndicator.html'

    export let linterOptionButton,
        linterOptions,
        runConfiguration,
        runButton,
        stopButton,
        cursorPosition

    export let runConfigurationDisplay = '',
        children = {}

    onMount(() => {
        Object.assign(g, children)
//        g.linterOptions = linterOptions
//        g.toolbar = this
//        schedule(() => {
//            g.tooltip.register(run.refs.button)
//        })
    })

    // [svelte-upgrade suggestion]
    // review these functions and remove unnecessary 'export' keywords
    export function togglePopup(name) {
        const popup = g[name]
        const { left, right } = event.target.getBoundingClientRect()
        popup.open = !popup.open
        if (popup.open) {
            popup.left = (left + right) / 2
        }
//        name].set({ active: !open })
    }

    export function run() {
        const { mode } = g.runConfiguration.get()
        if (!g.activeEditor && mode !== 'shell') {
            g.notificationBar.show('warning', 'Please open a Python file to run.')
            return
        }
        switch (mode) {
            case 'script':
            case 'module':
            case 'shell':
                if (!g.activeEditor.cm.isClean())
                    g.saveFile()
                g.console.runInTerminal()
                break
            case 'interactive':
                g.console.startKernel(false)
                break
            case 'realtime':
                g.console.startKernel(true)
                break
        }
    }

    export function stop() {
        g.console.stop()
    }
</script>

