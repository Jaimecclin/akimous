<div id="toolbar">
    <div id="buttons">
        <ToolbarButton ref:linterOptions on:click="togglePopup('linterOptions')" iconClass="fas fa-check-circle" title="Beautifier and Linter Options" />
        <ToolbarButton ref:keymapSettings on:click="togglePopup('keymapSettings')" iconClass="fas fa-fw fa-keyboard" title="Keymap Settings" />
        <ToolbarButton ref:notificationHistory on:click="togglePopup('notificationHistory')" iconClass="fas fa-fw fa-bell" title="Notification History" />
        <span class="gap">|</span>
        <ToolbarButton ref:debug iconClass="fas fa-bug" title="Debug" />
        <ToolbarButton ref:stop on:click="stop()" iconClass="fas fa-square" title="Stop" />
        <ToolbarButton ref:run on:click="run()" iconClass="fas fa-play" title="Run" />
        <ToolbarButton ref:runConfiguration on:click="togglePopup('runConfiguration')" iconClass="fas fa-caret-down" title="Run Configuration">
            <span class="text">Run Configuration</span>
        </ToolbarButton>
        <CursorPosition ref:cursorPosition />
    </div>
</div>
<MenuBar></MenuBar>
<CommandPalette></CommandPalette>
<NotificationBar></NotificationBar>
<TabNumber></TabNumber>
<NotificationHistory></NotificationHistory>
<LinterOptions></LinterOptions>
<RunConfiguration></RunConfiguration>
<KeymapSettings></KeymapSettings>

<style>
    #toolbar {
        height: var(--toolbar-height);
        background: var(--panel-color);
        border-bottom: var(--panel-border);
        box-sizing: border-box;
        z-index: 200;
        user-select: none;
    }

    #buttons {
        position: absolute;
        right: 0;
    }

    .gap {
        color: var(--gray5);
    }

    .text {
        font-size: var(--ui-font-size-small);
    }

</style>

<script>
    import g from '../lib/Globals'
    import { schedule } from '../lib/Utils'

    export default {
        components: {
            NotificationBar: './NotificationBar.html',
            NotificationHistory: '../popups/NotificationHistory.html',
            LinterOptions: '../popups/LinterOptions.html',
            RunConfiguration: '../popups/RunConfiguration.html',
            KeymapSettings: '../popups/KeymapSettings.html',
            TabNumber: './TabNumber.html',
            ToolbarButton: './ToolbarButton.html',
            MenuBar: './MenuBar.html',
            CursorPosition: './CursorPosition.html',
            CommandPalette: './CommandPalette.html'
        },
        oncreate() {
            g.toolbar = this
            schedule(() => {
                g.tooltip.register(this.refs.run.refs.button)
            })
        },
        data() {
            return {}
        },
        methods: {
            togglePopup(name) {
                const popup = g[name]
                const { left, right } = event.target.getBoundingClientRect()
                const { open } = popup.get()
                popup.set({
                    open: !open,
                    left: (left + right) / 2
                })
                this.refs[name].set({ active: !open })
            },
            run() {
                const { mode } = g.runConfiguration.get()
                if (!g.activeEditor && mode !== 'shell') {
                    g.notificationBar.show('warning', 'Please open a Python file to run.')
                    return
                }
                switch (mode) {
                    case 'script':
                    case 'module':
                    case 'shell':
                        if (!g.activeEditor.cm.isClean())
                            g.saveFile()
                        g.console.runInTerminal()
                        break
                    case 'interactive':
                        g.console.startKernel(false)
                        console.warn('meow')
                        break
                    case 'realtime':
                        g.console.startKernel(true)
                        break
                }
            },
            stop() {
                g.console.stop()
            }
        }
    }

</script>
