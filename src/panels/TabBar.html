<div ref:tabBar id="tab-bar">

</div>


<style>
    #tab-bar {
        width: 100%;
        height: var(--tab-bar-height);
        position: absolute;
        background: var(--panel-color);
        border-bottom: 0.07rem solid var(--panel-delimiter-color);
        margin: 0;
        z-index: -1;
    }

</style>


<script>
    import g from '../lib/Globals'
    import Tab from './Tab.html'
    import Sortable from 'sortablejs'

    export default {
        components: {},
        oncreate() {
            g.tabBar = this
            this.pathToTab = {} // /path/to/a/file.py -> <Tab>
            this.observe('activeFilePath', (activeFilePath, inactiveFilePath) => {
                const activeTab = this.pathToTab[activeFilePath]
                const inactiveTab = this.pathToTab[inactiveFilePath]
                activeTab && activeTab.set({
                    active: true
                })
                inactiveTab && inactiveTab.set({
                    active: false
                })
            })
            this.sortable = Sortable.create(this.refs.tabBar, {
                animation: 0,
            })
        },
        methods: {
            openTab(filePath, fileName) {
                const tab = new Tab({
                    target: this.refs.tabBar,
                    data: {
                        filePath,
                        fileName,
                        active: true
                    }
                })
            },
            closeTab(filePath) {
                this.pathToTab[filePath].destroy()
                delete this.pathToTab[filePath]
            },
            renameDir(newPath, oldPath) {
                const tab = this.pathToTab[oldPath]
                tab.set({
                    filePath: newPath,
                })
                const activeFilePath = this.get('activeFilePath')
                if (activeFilePath && activeFilePath.indexOf(oldPath) === 0)
                    this.set({
                        activeFilePath: activeFilePath.replace(oldPath, newPath)
                    })
            },
            renameFile(newPath, newName) {
                // must renameDir first befor calling this
                const tab = this.pathToTab[newPath]
                if (!tab) return

                tab.set({
                    fileName: newName,
                })
            },
            setClean(filePath) {
                this.pathToTab[filePath].set({
                    clean: true
                })
            },
            setDirty(filePath) {
                this.pathToTab[filePath].set({
                    clean: false
                })
            }
        }
    }

</script>
