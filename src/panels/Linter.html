<div class="container {active?'':'gone'}">
    <div ref:linter id="linter">
        <div class="title non-selectable">Pylint</div>
        <table id="pylint-result" class="non-selectable">
            {#each offlineLintingResult as message, i}
            <tr on:click="jumpTo(message.line, message.column)" on:mouseover="showPopup(i, event)" on:mouseleave="closePopup(event)">
                <td class="line-number">{message.line}</td>
                <td class="{message.type} message">{message.message0}</td>
            </tr>
            {/each}
        </table>
    </div>
</div>

<style>
    .container {
        height: calc(100% - var(--indicator-height) - var(--tab-bar-height));
    }

    #linter {
        height: 100%;
        overflow-y: scroll;
    }

    .title {
        padding: .3rem;
        color: var(--gray7);
        font-size: var(--ui-font-size-large);
    }

    #pylint-result {
        width: 100%;
        background: var(--main-bg-color);
    }

    table {
        table-layout: fixed;
    }

    table,
    td {
        padding: 0;
        margin: 0;
        border-spacing: 0;
    }

    td {
        vertical-align: top;
        cursor: default;
        border-bottom: 1px solid var(--panel-delimiter-color);
    }

    tr:hover {
        color: white;
        background: var(--gray4);
    }

    .line-number {
        width: 2rem;
        padding: .3rem;
        text-align: right;
        color: var(--ui-font-color);
        background: var(--primary2);
        font-family: var(--monospace-font-family);
    }

    tr:hover>.line-number {
        color: white;
        background: var(--primary4);
    }

    .message {
        padding: .3rem .5rem;
    }

    .informational {
        color: var(--purple);
    }

    .refactor {
        color: var(--blue);
    }

    .convention {
        color: var(--ao);
    }

    .warning {
        color: var(--yellow);
    }

    .error {
        color: var(--brighter-red);
    }

</style>


<script>
    import g from '../lib/Globals'
    import { initializeTabView, capitalize } from '../lib/Utils'

    export default {
        components: {},
        oncreate() {
            g.linter = this
            initializeTabView(this, 'Linter', 'fas fa-check-circle l-green')
        },
        data() {
            return {
                active: false,
                offlineLintingResult: []
            }
        },
        methods: {
            jumpTo(line, ch) {
                const editor = g.activeEditor
                if (!editor) return
                g.activeEditor.cm.setCursor(line - 1, ch)
                editor.cm.focus()
            },
            showPopup(i, event) {
                const { x, y, height } = event.currentTarget.getBoundingClientRect()
                const message = this.get().offlineLintingResult[i]
                g.popup.set({
                    open: true,
                    content: `<table>
                            <tr>
				                <td class="key">Location</td>
				                <td class="value">
                                    Line ${message.line}, column ${message.column}
                                    <div class="lint-location">${message.message1}</div>
                                </td>
			                </tr>
                            <tr>
				                <td class="key">Name</td>
				                <td class="value">${message['message-id']}: ${message.symbol}</td>
			                </tr>
                            <tr>
				                <td class="key">Message</td>
				                <td class="value">${message.message0}</td>
			                </tr>
                        </table>`
                })
                g.popup.reposition(x, y + height / 2)
            },
            closePopup(event) {
                g.popup.closeIfNotHovered(event)
            }
        }
    }

</script>
