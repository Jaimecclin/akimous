<div ref:fileTree class="file-tree">
    <div class="container" ref:children></div>
</div>


<style>
    .file-tree {
        width: 100%;
        height: calc(100% - .8rem);
        padding: .4rem 0;
        color: var(--basic-ui-font-color);
        font-family: var(--basic-ui-font-family);
        font-size: var(--basic-ui-font-size);
        -webkit-font-smoothing: subpixel-antialiased;
        user-select: none;
        -webkit-user-select: none;
        overflow-x: scroll;
    }
    .container {
        min-width: 100%;
        display: inline-block;
    }

</style>


<script>
    import g from '../lib/Globals'
    import WSClient from '../lib/WSClient'
    import FileTreeNode from './FileTreeNode.html'


    export default {
        components: {
        },
        oncreate() {
            this.children = []
            this.openedFolders = {}

            const addNode = (parent, file, isFolder) => {
                parent.children.push(new FileTreeNode({
                    target: parent.refs.children,
                    data: {
                        displayName: file.name,
                        path: file.path,
                        isFolder,
                        fileTree: this,
                        level: parent.get('level') + 1
                    }
                }))
            }

            this.ws = new WSClient('ws://127.0.0.1:3179/fileTree')
            this.ws.addHandler('openFolder', data => {
                console.log('data', data)
                let target = this.openedFolders[data.path]
                if (!target) {
                    target = this
                    // clear all children
                    for (const child of this.children) {
                        child.destroy()
                    }
                    this.children.length = 0
                }
                for (const dir of data.dirs) {
                    addNode(target, dir, true)
                }
                for (const file of data.files) {
                    addNode(target, file, false)
                }

            })
            this.ws.connect(() => {
                this.ws.send({
                    cmd: 'openFolder',
                    path: this.get('path'),
                })
            })
        },
        data() {
            return {
                path: '.',
                level: -1,

            }
        },
        methods: {}
    }

</script>
