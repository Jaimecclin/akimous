<div id="popup" ref:popup style="display:{open?'block':'none'}" on:mouseleave="set({open: false})">{@html content} <div id="popup-arrow"></div></div>


<style>
    #popup {
        z-index: 999;
        position: absolute;
        width: 30rem;
        min-height: 3rem;
        background: var(--gray9);
        border-radius: var(--default-radius);
        box-shadow: var(--default-shadow);
        color: var(--gray3);
        padding: .5rem .5rem;
        max-height: 80%;
    }

    :global(#popup table) {
        border-spacing: 1rem .5rem;
        margin-bottom: 0;
    }

    :global(#popup td.key) {
        color: var(--primary5);
        text-align: right;
        font-weight: 400;
        vertical-align: top;
    }
    
    :global(#popup .code) {
        font-family: var(--monospace-font-family);
        white-space: pre;
        max-height: 30rem;
        overflow-y: scroll;
    }

    /* https://leaverou.github.io/bubbly/ */
    #popup-arrow {
        content: '';
        position: absolute;
        top: 50%;
        right: 0;
        margin-top: -.5rem;
        border: .5rem solid transparent;
        border-left-color: var(--modal-bg-color);
        border-right: 0;
        margin-right: -.2rem;
    }

    #popup:before {
        content: '';
        position: absolute;
        right: 0;
        top: 0;
        border-right: 0;
        margin-right: -.5rem;
        height: 100%;
        width: 1rem;
        z-index: 9;
    }

</style>


<script>
    import g from '../lib/Globals'

    export default {
        components: {},
        oncreate() {
            g.popup = this
        },
        data() {
            return {
                open: false,
                content: '',
            }
        },
        methods: {
            reposition(x, y) {
                const rem = parseFloat(getComputedStyle(document.documentElement).fontSize)
                const { height } = this.refs.popup.getBoundingClientRect()
                let yAdjusted = y - height / 2
                if (y + height / 2 > document.documentElement.clientHeight)
                    yAdjusted = document.documentElement.clientHeight - height
                if (yAdjusted < 0)
                    yAdjusted = 0
                this.refs.popup.style.left = `${x - 31 * rem}px`
                this.refs.popup.style.top = `${yAdjusted}px`
                const el = document.querySelector('#popup-arrow')
                el.style.top = `${y - yAdjusted}px`
            },
            closeIfNotHovered(event) {
                if (event.relatedTarget && event.relatedTarget.id === 'popup') return
                this.set({ open: false })
            }
        }
    }

</script>
