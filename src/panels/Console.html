<div class="container {active?'':'gone'}">
    <div ref:terminal class="tab-view"></div>
</div>


<style>
    .container {
        padding: .4rem;
        height: calc(100% - var(--indicator-height) - var(--tab-bar-height));
    }

</style>


<script>
    import g from '../lib/Globals'
    import { initializeTabView } from '../lib/Utils'
    import Terminal from 'xterm/dist/xterm'
    import fit from 'xterm/lib/addons/fit/fit'
    // import attach from 'xterm/lib/addons/attach/attach'


    export default {
        components: {},
        oncreate() {
            g.console = this
            initializeTabView(this, 'Console', 'fas fa-desktop l-purple')
            this.initialized = false
        },
        onupdate({ changed, current }) {
            if (changed.active) {
                if (!this.initialized && current.active) {
                    this.initializeTerminal()
                    this.initialized = true
                }

            }
        },
        data() {
            return {
                active: false
            }
        },
        methods: {
            initializeTerminal() {
                this.tab.set({ active: false })
                this.tab.set({ active: true })
                
                requestAnimationFrame(() => {
                    Terminal.applyAddon(fit)
                    const rem = parseFloat(getComputedStyle(document.documentElement).fontSize)
                    this.terminal = new Terminal({
                        tabStopWidth: 4,
                        fontSize: 1.2 * rem,
                        fontFamily: 'Source Code Pro',
                        theme: {
                            foreground: '#CCC',
                            background: '#3F3F3F'
                        }
                    })
                    this.terminal.open(this.refs.terminal, false)
                    this.terminal.on('focus', () => {
                        g.setFocus([g.panelRight, this])
                    })

                    requestAnimationFrame(() => {
                        this.terminal.fit()
                        for (let i = 0; i < 3; i++)
                            this.terminal.write('blabla')
                    })
                })
            }
        }
    }

</script>
